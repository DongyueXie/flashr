<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flash introduction • flashr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Flash introduction">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">flashr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/stephenslab/flashr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Flash introduction</h1>
                        <h4 class="author">Matthew Stephens</h4>
            
            <h4 class="date">September 23, 2017</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This is a brief introduction to the <code>flashr</code> package. The examples here will suffice for many users. For more advanced usage, see the other vignettes.</p>
</div>
<div id="model-summary" class="section level1">
<h1 class="hasAnchor">
<a href="#model-summary" class="anchor"></a>Model summary</h1>
<p>The <code>flashr</code> package fits the model <span class="math display">\[Y = LF' + E\]</span> where <span class="math inline">\(Y\)</span> is an <span class="math inline">\(n \times p\)</span> matrix, <span class="math inline">\(L\)</span> is an <span class="math inline">\(n \times k\)</span> matrix, and <span class="math inline">\(F\)</span> is a <span class="math inline">\(p \times k\)</span> matrix, and <span class="math inline">\(E\)</span> is an <span class="math inline">\(n \times p\)</span> matrix of residuals which (by default) are assumed to have column-specific variances:</p>
<p><span class="math display">\[E_{ij} \sim N(0,\sigma_{j}^2).\]</span></p>
<p>The columns of <span class="math inline">\(L\)</span> are called the “loadings” and columns of <span class="math inline">\(F\)</span> are called the “factors”. Unlike some other methods (e.g. singular value decomoposition) these columns are not required to be orthogonal.</p>
<p>The key idea behind <code>flashr</code> is to use Empirical Bayes methods to estimate a “prior” distribution for each factor and each loading. This can induce sparsity on either/or factors and loadings if the data support this.</p>
<p>The scaling of the factors and loadings in the above model is arbitrary. Often it is convenient to scale the loadings and columns to have unit norm. In this case we can write</p>
<p><span class="math display">\[Y = LDF' + E,\]</span></p>
<p>where <span class="math inline">\(D\)</span> is a diagonal matrix of “weights” that capture the strength of each factor/loading. The flash function <code>flash_get_ldf</code> returns the values of <span class="math inline">\(L, D\)</span> and <span class="math inline">\(F\)</span> in this model (with <span class="math inline">\(D\)</span> returned as a vector of the diagonal values).</p>
</div>
<div id="examples-of-running-flash" class="section level1">
<h1 class="hasAnchor">
<a href="#examples-of-running-flash" class="anchor"></a>Examples of running flash</h1>
<div id="simulate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate Data</h2>
<p>First we will simulate some data for illustration (in this case the loadings and factors are not at all sparse, so the benefits of flash over other methods might be limited.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(flashr)
<span class="kw">set.seed</span>(<span class="dv">1</span>)
n =<span class="st"> </span><span class="dv">100</span>
p =<span class="st"> </span><span class="dv">500</span>
k =<span class="st"> </span><span class="dv">7</span>
LL =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n<span class="op">*</span>k),<span class="dt">nrow=</span>n)
FF =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(p<span class="op">*</span>k),<span class="dt">nrow=</span>p)
Y =<span class="st"> </span>LL <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(FF) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n<span class="op">*</span>p)</code></pre></div>
</div>
<div id="fitting-the-model-and-extracting-results" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-model-and-extracting-results" class="anchor"></a>Fitting the model and extracting results</h2>
<p>When running <code>flash</code>, usually you will run one command to fit the model, and a second to extract results you want from the fit. The <code>flash</code> function is the one most users will want to start with to fit the model. The <code>flash_get_ldf</code> function can then be used to get the values of <span class="math inline">\(L,D\)</span> and <span class="math inline">\(F\)</span>.</p>
<p>By default <code>flash</code> runs the greedy algorithm from Wang and Stephens. This is usually the quickest approach. It simply adds factors one at a time, until adding a new factor doesn’t improve the fit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f =<span class="st"> </span><span class="kw"><a href="../reference/flash.html">flash</a></span>(Y)
<span class="co"># fitting factor/loading 1</span>
<span class="co"># fitting factor/loading 2</span>
<span class="co"># fitting factor/loading 3</span>
<span class="co"># fitting factor/loading 4</span>
<span class="co"># fitting factor/loading 5</span>
<span class="co"># fitting factor/loading 6</span>
<span class="co"># fitting factor/loading 7</span>
<span class="co"># fitting factor/loading 8</span>
ldf =<span class="st"> </span><span class="kw"><a href="../reference/flash_get_ldf.html">flash_get_ldf</a></span>(f)
ldf<span class="op">$</span>d
<span class="co"># [1] 292.3761 253.6873 233.4289 210.8591 204.2400 203.0717 182.1317</span></code></pre></div>
<p>Note that flash correctly stopped at 7 factors for these data. (Although it tries to fit an 8th factor, from the results we can see that this does not appear: this is because it turned out to be 0.)</p>
</div>
<div id="backfitting" class="section level2">
<h2 class="hasAnchor">
<a href="#backfitting" class="anchor"></a>Backfitting</h2>
<p>Sometimes the backfitting algorithm can improve the fit (but it takes longer). To do backfitting on a previous flash fit you can provide that fit as the <code>f_init</code> parameter, and set <code>backfit=TRUE</code>. Here we use the fit obtained from the greedy function as our initialization.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f.b =<span class="st"> </span><span class="kw"><a href="../reference/flash.html">flash</a></span>(Y, <span class="dt">f_init =</span> f, <span class="dt">backfit=</span><span class="ot">TRUE</span>, <span class="dt">greedy=</span><span class="ot">FALSE</span>)
ldf.b =<span class="st"> </span><span class="kw"><a href="../reference/flash_get_ldf.html">flash_get_ldf</a></span>(f.b)
ldf.b<span class="op">$</span>d
<span class="co"># [1] 303.7844 263.2466 241.8200 217.4748 209.0290 206.0587 183.2006</span></code></pre></div>
</div>
<div id="combining-greedy-backfitting" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-greedy-backfitting" class="anchor"></a>Combining greedy + backfitting</h2>
<p>If you know you are going to want to do backfitting anyway, you can do greedy+backfitting it in one command without saving the intermediate result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f.gb =<span class="st"> </span><span class="kw"><a href="../reference/flash.html">flash</a></span>(Y, <span class="dt">backfit=</span><span class="ot">TRUE</span>, <span class="dt">greedy=</span><span class="ot">TRUE</span>)
<span class="co"># fitting factor/loading 1</span>
<span class="co"># fitting factor/loading 2</span>
<span class="co"># fitting factor/loading 3</span>
<span class="co"># fitting factor/loading 4</span>
<span class="co"># fitting factor/loading 5</span>
<span class="co"># fitting factor/loading 6</span>
<span class="co"># fitting factor/loading 7</span>
<span class="co"># fitting factor/loading 8</span>
ldf.gb =<span class="st"> </span><span class="kw"><a href="../reference/flash_get_ldf.html">flash_get_ldf</a></span>(f.gb)
ldf.gb<span class="op">$</span>d
<span class="co"># [1] 303.7844 263.2466 241.8200 217.4748 209.0290 206.0587 183.2006</span></code></pre></div>
</div>
</div>
<div id="using-flash-to-fill-in-missing-data" class="section level1">
<h1 class="hasAnchor">
<a href="#using-flash-to-fill-in-missing-data" class="anchor"></a>Using flash to fill in missing data</h1>
<p>Suppose your matrix has some missing entries and you want to fill them in. You can do this by first running flash on your matrix and then using <code>flash_fill</code>. (This function fills in the missing entries using the relevant elements of the estimated LDF’ matrix).</p>
<p>To illustrate, we add a little missing data to <span class="math inline">\(Y\)</span> here before running.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ymiss=Y
Ymiss[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,<span class="dv">1</span>] =<span class="st"> </span><span class="ot">NA</span>
f =<span class="st"> </span><span class="kw"><a href="../reference/flash.html">flash</a></span>(Ymiss)
<span class="co"># fitting factor/loading 1</span>
<span class="co"># fitting factor/loading 2</span>
<span class="co"># fitting factor/loading 3</span>
<span class="co"># fitting factor/loading 4</span>
<span class="co"># fitting factor/loading 5</span>
<span class="co"># fitting factor/loading 6</span>
<span class="co"># fitting factor/loading 7</span>
<span class="co"># fitting factor/loading 8</span>
Ynew =<span class="st"> </span><span class="kw"><a href="../reference/flash_fill.html">flash_fill</a></span>(Ymiss,f)
<span class="kw">plot</span>(Y[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,<span class="dv">1</span>],Ynew[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,<span class="dv">1</span>])</code></pre></div>
<p><img src="flash_intro_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#model-summary">Model summary</a></li>
      <li>
<a href="#examples-of-running-flash">Examples of running flash</a><ul class="nav nav-pills nav-stacked">
<li><a href="#simulate-data">Simulate Data</a></li>
      <li><a href="#fitting-the-model-and-extracting-results">Fitting the model and extracting results</a></li>
      <li><a href="#backfitting">Backfitting</a></li>
      <li><a href="#combining-greedy-backfitting">Combining greedy + backfitting</a></li>
      </ul>
</li>
      <li><a href="#using-flash-to-fill-in-missing-data">Using flash to fill in missing data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Stephens, Wei Wang, Jason Willwerscheid.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
